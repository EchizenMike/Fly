<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>平日成绩登记</title>
<link rel="icon" href="favicon.ico" type="image/ico">
<meta name="keywords" content="LightYear,光年,后台模板,后台管理系统,光年HTML模板">
<meta name="description" content="LightYear是一个基于Bootstrap v3.3.7的后台管理系统的HTML模板。">
<meta name="author" content="yinqi">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/materialdesignicons.min.css" rel="stylesheet">
<link href="css/style.min.css" rel="stylesheet">
<link rel="stylesheet" href="js/jconfirm/jquery-confirm.min.css">
<link href="css/animate.css" rel="stylesheet"> <!--动画效果-->
<link href="https://www.layuicdn.com/layui/css/layui.css" rel="stylesheet" type="text/css" />
<!--时间选择插件-->
<link rel="stylesheet" href="js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css">
<!--日期选择插件-->
<link rel="stylesheet" href="js/bootstrap-datepicker/bootstrap-datepicker3.min.css">
<link href="css/style.min.css" rel="stylesheet">

</head>
  <style>
	input::-webkit-outer-spin-button,
	input::-webkit-inner-spin-button {
    -webkit-appearance: none;
}

</style>
<body>
<div class="lyear-layout-web">
  <div class="lyear-layout-container">
    <!--左侧导航-->
        <aside class="lyear-layout-sidebar">
       
      <!-- logo -->
      <div id="logo" class="sidebar-header">
        <a href="index.html"><img src="images/logo-sidebar.png" title="LightYear" alt="LightYear" /></a>
      </div>
      <div class="lyear-layout-sidebar-scroll">
        
        <nav class="sidebar-main">
          <ul class="nav nav-drawer">
            <li class="nav-item"> <a href="index.html"><i class="mdi mdi-home"></i>首页</a> </li>
            <li class="nav-item nav-item-has-subnav" id="m2">
              <a href="javascript:void(0)"><i class="mdi mdi-account"></i>个人信息</a>
              <ul class="nav nav-subnav">
                <li> <a href="lyear_forms_elements.html">个人信息维护</a> </li>
                <!--<li> <a href="lyear_forms_radio.html">单选框</a> </li>
                <li> <a href="lyear_forms_checkbox.html">复选框</a> </li>
                <li> <a href="lyear_forms_switch.html">开关</a> </li>-->
              </ul>
            </li>
           
           <li class="nav-item nav-item-has-subnav active open" id="m3">
              <a href="javascript:void(0)"><i class="mdi mdi-content-paste"></i>成绩登记</a>
              <ul class="nav nav-subnav">
                <li class="active"> <a href="lyear_pages_edit_ach.html">平日成绩登记</a> </li>
                <li> <a href="lyear_pages_edit_gk_ach.html">高考信息登记</a> </li>
              </ul>
            </li>
       
           
          </ul>
        </nav>
        
        <div class="sidebar-footer">
					<p class="copyright">Copyright &copy; 2020. All rights reserved.<br /> 青岛市实验高级中学 版权所有<br /> 鲁ICP备06019373号-2</p> 
        </div>
      </div>
      
    </aside>
    <!--End 左侧导航-->
    
    <!--头部信息-->
    <header class="lyear-layout-header">
      
      <nav class="navbar navbar-default">
        <div class="topbar">
          
          <div class="topbar-left">
            <div class="lyear-aside-toggler">
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
            </div>
            <span class="navbar-page-title">平日成绩登记 </span>
          </div>
          
          <ul class="topbar-right">
            <li class="dropdown dropdown-profile">
              <a href="javascript:void(0)" data-toggle="dropdown">
                <!--<img class="img-avatar img-avatar-48 m-r-10" src="images/users/avatar.jpg" alt="笔下光年" />-->
                <span id="user">用户名 <span class="caret"></span></span>
              </a>
              <ul class="dropdown-menu dropdown-menu-right">
                <!--<li> <a href="lyear_pages_profile.html"><i class="mdi mdi-account"></i> 个人信息</a> </li>-->
                <li> <a href="lyear_pages_edit_pwd.html"><i class="mdi mdi-lock-outline"></i>修改密码</a> </li>
                <li> <a href="javascript:void(0)"><i class="mdi mdi-delete"></i>清空缓存</a></li>
                <li class="divider"></li>
                <li> <a href="javascript:window.localStorage.removeItem('date');clearCookie('user');window.location.href = 'login.html';"><i class="mdi mdi-logout-variant"></i>退出登录</a> </li>
              </ul>
            </li>
            <!--切换主题配色-->
		    <li class="dropdown dropdown-skin">
			  <span data-toggle="dropdown" class="icon-palette"><i class="mdi mdi-palette"></i></span>
			  <ul class="dropdown-menu dropdown-menu-right" data-stopPropagation="true">
                <li class="drop-title"><p>主题</p></li>
                <li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="site_theme" value="default" id="site_theme_1" checked>
                    <label for="site_theme_1"></label>
                  </span>
                  <span>
                    <input type="radio" name="site_theme" value="dark" id="site_theme_2">
                    <label for="site_theme_2"></label>
                  </span>
                  <span>
                    <input type="radio" name="site_theme" value="translucent" id="site_theme_3">
                    <label for="site_theme_3"></label>
                  </span>
                </li>
			    <li class="drop-title"><p>LOGO</p></li>
				<li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="logo_bg" value="default" id="logo_bg_1" checked>
                    <label for="logo_bg_1"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_2" id="logo_bg_2">
                    <label for="logo_bg_2"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_3" id="logo_bg_3">
                    <label for="logo_bg_3"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_4" id="logo_bg_4">
                    <label for="logo_bg_4"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_5" id="logo_bg_5">
                    <label for="logo_bg_5"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_6" id="logo_bg_6">
                    <label for="logo_bg_6"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_7" id="logo_bg_7">
                    <label for="logo_bg_7"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_8" id="logo_bg_8">
                    <label for="logo_bg_8"></label>
                  </span>
				</li>
				<li class="drop-title"><p>头部</p></li>
				<li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="header_bg" value="default" id="header_bg_1" checked>
                    <label for="header_bg_1"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_2" id="header_bg_2">
                    <label for="header_bg_2"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_3" id="header_bg_3">
                    <label for="header_bg_3"></label>
                  </span>
                  <span>
                    <input type="radio" name="header_bg" value="color_4" id="header_bg_4">
                    <label for="header_bg_4"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_5" id="header_bg_5">
                    <label for="header_bg_5"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_6" id="header_bg_6">
                    <label for="header_bg_6"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_7" id="header_bg_7">
                    <label for="header_bg_7"></label>
                  </span>
                  <span>
                    <input type="radio" name="header_bg" value="color_8" id="header_bg_8">
                    <label for="header_bg_8"></label>
                  </span>
				</li>
				<li class="drop-title"><p>侧边栏</p></li>
				<li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="sidebar_bg" value="default" id="sidebar_bg_1" checked>
                    <label for="sidebar_bg_1"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_2" id="sidebar_bg_2">
                    <label for="sidebar_bg_2"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_3" id="sidebar_bg_3">
                    <label for="sidebar_bg_3"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_4" id="sidebar_bg_4">
                    <label for="sidebar_bg_4"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_5" id="sidebar_bg_5">
                    <label for="sidebar_bg_5"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_6" id="sidebar_bg_6">
                    <label for="sidebar_bg_6"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_7" id="sidebar_bg_7">
                    <label for="sidebar_bg_7"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_8" id="sidebar_bg_8">
                    <label for="sidebar_bg_8"></label>
                  </span>
				</li>
			  </ul>
			</li>
            <!--切换主题配色-->
          </ul>
          
        </div>
      </nav>
      
    </header>
    <!--End 头部信息-->
    
    <!--页面主要内容-->
    <main class="lyear-layout-content">
      
      <div class="container-fluid">
        
        <div class="row" id="card_0">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body" >
                <form method="post" action="" class="site-form" onsubmit="return false;">
                    <div class="form-group">
                    <div class="row" >
                    	 <div class="col-xs-3">
                        <label for="maj">主修专业</label>
                        <select class="form-control maj" id="stu_maj" name="stu_maj" size="1">
                        <option value="">请选择主修专业</option>
                      </select>
                      </div>
                      <div class="col-xs-3">
                        <label for="sumach">距离/秒数</label>
                        <input class="form-control" type="number" id="ls" placeholder="请输入...">
                      </div>
                      <div class="col-xs-3">
                      	<label for="mjcont">成绩</label>
                        <input class="form-control" type="number" id="ach" placeholder="请输入...">
                      </div>
                       <div class="col-xs-3">
                      	<label for="mjach">登记时间</label>
                       <!-- <input class="form-control" type="text" id="mjach" placeholder="请输入...">-->
                       	 <!--<input class="form-control js-datepicker" type="text" id="time" name="add_time" data-date-format="yyyy/mm/dd" placeholder="请选择具体时间" value="" data-side-by-side="true" data-locale="zh-cn" data-format="YYYY-MM-DD HH:mm" />-->
                      <input type="text" class="form-control layui-input" type="date" placeholder="请选择日期..." id="time" onfocus="this.blur();">
                       </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <button class="btn btn-primary sub" type="submit">保存</button>
                  </div>
                </form>
       
              </div>
            </div>
          </div>
          
        </div>
        
                <div class="row">
          
          <div class="col-lg-12">
            <div class="card">
              <div class="card-header">
                <h4 id="card_header_title">历史成绩登记记录</h4>
              </div>
              <div class="card-body" id="card_body">
                <table class="layui-hide" id="table" lay-filter="test"></table>  
              </div>
            </div>
          </div>
          
        </div>
        
      </div>
      
    </main>
    <!--End 页面主要内容-->
  </div>
</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/perfect-scrollbar.min.js"></script>
<script src="js/jconfirm/jquery-confirm.min.js"></script>
<script src="js/bootstrap-notify.min.js"></script>
<script type="text/javascript" src="js/lightyear.js"></script>
<script type="text/javascript" src="js/main.min.js"></script>
<script src="https://www.layuicdn.com/layui/layui.js" charset="utf-8"></script>

<!--时间选择插件-->
<script src="js/bootstrap-datetimepicker/moment.min.js"></script>
<script src="js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="js/bootstrap-datetimepicker/locale/zh-cn.js"></script>
<!--日期选择插件-->
<script src="js/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
<script src="js/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>
<script src="js/cookie.js"></script>
<script type="text/javascript">
$('.sub').on('click', function () {
     var maj = document.getElementById("stu_maj").value;
     var ls = document.getElementById("ls").value;
     var ach = document.getElementById("ach").value;
     var time = document.getElementById("time").value;
    
    if(maj==''||ls==''||ach==''||time==''){
    	layer.msg('请填写完整信息！', {icon:2,anim:6});
    	return false;
    }
    
    
    $.alert({
        title: '确认',
        content: '请仔细确认： <br> 您所填写的内容 <strong>准确无误</strong>！',
		buttons: {
			confirm: {
				text: '确认',
				btnClass: 'btn-primary',
				action: function(){
              var ls = document.getElementById("ls").value;
              var ach = document.getElementById("ach").value;
              var time = document.getElementById("time").value;
              var name = getCookie("user").toString();     
   						
   						var stu_name = null;
   						var stu_id = null;
   $.ajax({
	 	type:"post",
	 	url:"./php/select_userinfo.php",
	 	async:false,
	 	dataType:'json',
	 	data:{'stu_name':name},
	 	success:function(data){
	 		if(data.code == 0){
//	 			console.log(JSON.stringify(data))
	 			stu_id = data.data[0].stu_id;
	 			stu_name = data.data[0].stu_name;
	 		}
	 	}
	 	});
                       
        $.ajax({
      	type:"post",
      	url:"./php/insert_achinfo.php",
        async:true,
        dataType:'json',
        data:{'username':name,'stu_id':stu_id,'stu_name':stu_name,'ls':ls,'maj':maj,'ach':ach,'time':time}
         });
                    
                    lightyear.notify('保存成功！', 'success', 5000, 'mdi mdi-checkbox-marked-circle-outline', 'top', 'right');
										setTimeout(function(){window.location.reload()}, 8000);
				}
			},
			cancel: {
				text: '取消',
				action: function () {
                    lightyear.notify('取消操作！', 'danger', 5000, 'mdi mdi-close-circle-outline', 'top', 'right');
				}
			}
		}
    });
});
</script>
 <script>
	var layer;
	layui.use('layer',function(){
		layer = layui.layer;
	});//加载layer模块
</script>
<script type="text/html" id="toolbarDemo">
  <div class="layui-btn-container">
    <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
    <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
    <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
  </div>
</script>

<script type="text/html" id="bar">
  <!--<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>-->
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
 
<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
  <script>
layui.use('table', function(){
  var table = layui.table;
  
  table.render({
    elem: '#table'
    ,url:'./php/select_achinfo.php'
    ,method:'post'
    ,where:{'stu_name':getCookie("user").toString()}
    ,toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
    ,defaultToolbar: ['filter', 'exports', 'print']
    ,title: '历史成绩登记记录'
    ,cols: [[
       {type: 'checkbox',width:40}
      ,{field:'num', title:'登记序号', width:200, unresize: true, sort: true}
      ,{field:'maj', title:'主修专业', width:200, unresize: true, sort: true}
      ,{field:'ls', title:'距离/秒数', width:200, edit: 'text'}
      ,{field:'ach', title:'成绩', width:200, edit: 'text'}
      ,{field:'time', title:'登记时间', width:200, edit: 'text'}
      ,{fixed: 'right', title:'操作', toolbar: '#bar', width:200}
    ]]
    , done: function (res, curr, count) {
            $("table").css("width", "100%");                 
         }
    ,page: true
  });
  
  //头工具栏事件
  table.on('toolbar(test)', function(obj){
    var checkStatus = table.checkStatus(obj.config.id);
    switch(obj.event){
      case 'getCheckData':
        var data = checkStatus.data;
        layer.alert(JSON.stringify(data));
      break;
      case 'getCheckLength':
        var data = checkStatus.data;
        layer.msg('选中了：'+ data.length + ' 个');
      break;
      case 'isAll':
        layer.msg(checkStatus.isAll ? '全选': '未全选');
      break;

    };
  });
  
  //监听行工具事件
  table.on('tool(test)', function(obj){
    var data = obj.data;
    //console.log(obj)
    if(obj.event === 'del'){
      layer.confirm('真的删除行么', function(index){
   $.ajax({
		type:"post",
		url:"./php/del_item.php",
		async:true,
		dataType:'json',
		data:{'id':data.num},
		success:function(data){
					layer.msg('已删除记录！');
		}
     });   
        obj.del();
        layer.close(index);
      });
    }
      
  });
});
</script>
<script type="text/javascript">
	$.ajax({
		type:"post",
		url:"./php/select_ach_maj.php",
		async:true,
		dataType:'json',
		data:{'user':getCookie("user").toString()},
		success:function(data){
			var maj = document.getElementById("stu_maj");
			var op = new Option(data.data[0].stu_maj_type+"-"+data.data[0].stu_maj,data.data[0].stu_maj_type+"-"+data.data[0].stu_maj);
			maj.options.add(op);
			var op = new Option(data.data[0].stu_maj_type2+"-"+data.data[0].stu_maj2,data.data[0].stu_maj_type2+"-"+data.data[0].stu_maj2);
			maj.options.add(op);
			var op = new Option(data.data[0].stu_maj_type3+"-"+data.data[0].stu_maj3,data.data[0].stu_maj_type3+"-"+data.data[0].stu_maj3);
			maj.options.add(op);
			var op = new Option(data.data[0].stu_maj_type4+"-"+data.data[0].stu_maj4,data.data[0].stu_maj_type4+"-"+data.data[0].stu_maj4);
			maj.options.add(op);
		}
	});
</script>
<script>
	if(getCookie("user").toString() == ''){
		window.location.href = 'login.html';
	}
	document.getElementById("user").innerHTML = getCookie("user");
	//检查用户权限
				$.ajax({
					type: "post",
					url: "./php/get_config.php",
					async: true,
					dataType: 'json',
					success: function(data) {
						if(data.data[0].switch_ach_config_days == 0){
							$("#card_body").remove();
							$("#card_0").remove();
							document.getElementById("card_header_title").innerHTML = "管理员未开放此功能，禁止操作！"
							document.getElementById("card_header_title").setAttribute("style","text-align: center;")
						}
					}
				});
//	//检查用户权限
//		$.ajax({
//			type:"post",
//			url:"./php/get_config.php",
//			async:true,
//			dataType:'json',
//			success:function(data){
//				if(data.data[0].switch_ach_config == 0)
//              $("#m3").remove();
//      else
//      		document.getElementById("m3").removeAttribute("style");
//			  if(data.data[0].switch_person_config == 0)
//					      $("#m2").remove();
//			  else
//			  	  document.getElementById("m2").removeAttribute("style");
//				
//				if(data.data[0].switch_ach_config == 0)
//						alert("本时段禁止访问！");
//						window.location.href = "about:black";
//	 					window.stop();
//	 					window.opener=null;
//	 					window.open('','_self');
//	 					window.close();//关闭窗口
//				
//			}
//		});
</script>
<script>
					layui.use('laydate', function() {
						var laydate = layui.laydate;

						laydate.render({
							elem: '#time',
							type: 'day',
							format:'yyyy/MM/dd',
							done:function(value, date, endDate){
								//var val = document.getElementById("stu_grade").value;//根据回调方法自带日期值无需从input获取了
								//table(value);
							}
						});
					});
				</script>
</body>
</html>